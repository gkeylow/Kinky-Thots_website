const d="kt_auth_token",c="kt_auth_user";class m{constructor(){this.token=localStorage.getItem(d),this.user=JSON.parse(localStorage.getItem(c)||"null"),this.modal=null,this.onAuthChange=null}init(){return this.modal=document.getElementById("authModal"),this.bindEvents(),this.updateUI(),this}bindEvents(){var e,t,s,n,a,i,r,l;(e=document.getElementById("authTrigger"))==null||e.addEventListener("click",o=>{o.preventDefault(),this.isAuthenticated()?this.showUserMenu():this.showModal()}),(t=document.getElementById("authModalClose"))==null||t.addEventListener("click",()=>this.hideModal()),(s=this.modal)==null||s.addEventListener("click",o=>{o.target===this.modal&&this.hideModal()}),document.querySelectorAll(".auth-tab").forEach(o=>{o.addEventListener("click",()=>this.switchTab(o.dataset.tab))}),(n=document.getElementById("loginForm"))==null||n.addEventListener("submit",o=>{o.preventDefault(),this.handleLogin()}),(a=document.getElementById("registerForm"))==null||a.addEventListener("submit",o=>{o.preventDefault(),this.handleRegister()}),(i=document.getElementById("forgotForm"))==null||i.addEventListener("submit",o=>{o.preventDefault(),this.handleForgotPassword()}),(r=document.getElementById("forgotPasswordLink"))==null||r.addEventListener("click",o=>{o.preventDefault(),this.showForgotForm()}),(l=document.getElementById("backToLoginLink"))==null||l.addEventListener("click",o=>{o.preventDefault(),this.showLoginForm()}),document.addEventListener("keydown",o=>{var u;o.key==="Escape"&&((u=this.modal)!=null&&u.classList.contains("active"))&&this.hideModal()})}showForgotForm(){var e,t;document.querySelectorAll(".auth-form").forEach(s=>s.classList.remove("active")),document.querySelectorAll(".auth-tab").forEach(s=>s.classList.remove("active")),(e=document.getElementById("forgotForm"))==null||e.classList.add("active"),document.getElementById("authModalTitle").textContent="Reset Password",(t=document.getElementById("forgotEmail"))==null||t.focus()}showLoginForm(){var e,t,s;document.querySelectorAll(".auth-form").forEach(n=>n.classList.remove("active")),(e=document.getElementById("loginForm"))==null||e.classList.add("active"),document.querySelectorAll(".auth-tab").forEach(n=>n.classList.remove("active")),(t=document.querySelector('.auth-tab[data-tab="login"]'))==null||t.classList.add("active"),document.getElementById("authModalTitle").textContent="Welcome Back",(s=document.getElementById("loginEmail"))==null||s.focus()}async handleForgotPassword(){const e=document.getElementById("forgotEmail").value,t=document.getElementById("forgotError"),s=document.getElementById("forgotSuccess"),n=document.querySelector("#forgotForm .auth-submit");n.disabled=!0,n.textContent="Sending...",t.classList.remove("visible"),s.classList.remove("visible");try{const a=await fetch("/api/auth/forgot-password",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e})}),i=await a.json();a.ok?(s.textContent=i.message||"Reset link sent! Check your email.",s.classList.add("visible"),document.getElementById("forgotEmail").value=""):(t.textContent=i.error||"Failed to send reset email",t.classList.add("visible"))}catch{t.textContent="Network error. Please try again.",t.classList.add("visible")}finally{n.disabled=!1,n.textContent="Send Reset Link"}}async handleLogin(){var a;const e=document.getElementById("loginEmail").value,t=document.getElementById("loginPassword").value,s=document.getElementById("loginError"),n=document.querySelector("#loginForm .auth-submit");n.disabled=!0,n.textContent="Logging in...",s.classList.remove("visible");try{const i=await fetch("/api/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:t})}),r=await i.json();i.ok&&r.success?(this.setAuth(r.token,r.user),this.hideModal(),this.updateUI(),(a=this.onAuthChange)==null||a.call(this,!0,r.user)):(s.textContent=r.error||"Login failed",s.classList.add("visible"))}catch{s.textContent="Network error. Please try again.",s.classList.add("visible")}finally{n.disabled=!1,n.textContent="Login"}}async handleRegister(){var r;const e=document.getElementById("registerUsername").value,t=document.getElementById("registerEmail").value,s=document.getElementById("registerPassword").value,n=document.getElementById("registerConfirm").value,a=document.getElementById("registerError"),i=document.querySelector("#registerForm .auth-submit");if(s!==n){a.textContent="Passwords do not match",a.classList.add("visible");return}i.disabled=!0,i.textContent="Creating account...",a.classList.remove("visible");try{const l=await fetch("/api/auth/register",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:e,email:t,password:s})}),o=await l.json();l.ok&&o.success?(this.setAuth(o.token,o.user),this.hideModal(),this.updateUI(),(r=this.onAuthChange)==null||r.call(this,!0,o.user)):(a.textContent=o.error||"Registration failed",a.classList.add("visible"))}catch{a.textContent="Network error. Please try again.",a.classList.add("visible")}finally{i.disabled=!1,i.textContent="Create Account"}}setAuth(e,t){this.token=e,this.user=t,localStorage.setItem(d,e),localStorage.setItem(c,JSON.stringify(t))}clearAuth(){this.token=null,this.user=null,localStorage.removeItem(d),localStorage.removeItem(c)}logout(){var e;this.clearAuth(),this.updateUI(),(e=this.onAuthChange)==null||e.call(this,!1,null),window.location.reload()}isAuthenticated(){return!!this.token&&!!this.user}getToken(){return this.token}getUser(){return this.user}showModal(){var e,t;(e=this.modal)==null||e.classList.add("active"),(t=document.getElementById("loginEmail"))==null||t.focus()}hideModal(){var e,t,s;(e=this.modal)==null||e.classList.remove("active"),(t=document.getElementById("loginForm"))==null||t.reset(),(s=document.getElementById("registerForm"))==null||s.reset(),document.querySelectorAll(".auth-error").forEach(n=>n.classList.remove("visible"))}switchTab(e){document.querySelectorAll(".auth-tab").forEach(t=>{t.classList.toggle("active",t.dataset.tab===e)}),document.querySelectorAll(".auth-form").forEach(t=>{t.classList.toggle("active",t.id===`${e}Form`)}),document.getElementById("authModalTitle").textContent=e==="login"?"Welcome Back":"Create Account"}updateUI(){const e=document.getElementById("authTrigger");e&&(this.isAuthenticated()?(e.textContent=this.user.username,e.classList.add("authenticated")):(e.textContent="Login",e.classList.remove("authenticated")))}showUserMenu(){confirm(`Logged in as ${this.user.username}

Logout?`)&&this.logout()}}const h=new m;h.init();
